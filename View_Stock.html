<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Stock Data</title>

  <style>
   /* #btnform {
      width: 150px;
      height: 65px;
      margin-top: 10px;
      justify-content: center;
      border-radius: 10px;
      background-color: white;
      border: 2px solid blue;
      opacity: 0.6;
      font-weight: 1000;
    }

    #btnform:hover {
      color: black;
    }

    #main_btn {
      margin-left: 9%;
    }

    #main_btn .View_Stock {
      border: 4px solid red;
    }

    #backdiv{
      float: left;
      width: 15%;
    }

    #backdiv #back {
      
      width: 70%;
      height: 50px;
      color: black;
      background-color: white;
      margin-top: 340px;
      margin-left: 10%;
      border: 3px solid black;
      border-radius: 10px;
      box-shadow: 5px 5px 5px black;
      font-size: 25px;
    }
    #backdiv #back:hover {
      color: black;
      background-color: white;
      border: 3px solid blue;
      border-radius: 10px;
      box-shadow: 5px 5px 5px blue;
    } */







    input[type="text"] {
      display: inline-block;
      padding: 10px;
      font-size: 16px;
      width: 300px;
      border: 2px solid black;
      border-radius: 7px;
      box-shadow: 5px 5px 7px black;
      margin-top: 10px;
    }
    input[type="text"]:hover {
      border-color: blue;
      box-shadow: 5px 5px 7px blue;
    }

    #inputdata{
      width: 90%;
      margin-left: 5%;
    }



    .table-container{
      float: right;
        border-collapse: collapse;
        margin-right: 4%;
        width: 80%;
        height: 350px; 
        overflow-y: auto;
        background-color: aqua;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin: 0 auto;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      padding-left: 40px;
      text-align: left;
    }

    th {
      background-color: blue;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #68b3e6;
    }

    #stockChartContainer {
      max-width: 800px;
      margin: 20px auto;
    }





    @media (min-width: 1728px) and (max-width: 1920px) {
      .table-container {
    width: 80%;
    margin-right: 5%;
    overflow-x: auto;
    overflow-y: auto;
  }
  #form-image{
    width: 100%;
  }

  /* #backdiv #back {
      
      width: 70%;
      height: 50px;
      color: black;
      background-color: white;
      margin-top: 320px;
      margin-left: 10%;
    } */
    input[type="text"] {
      display: inline-block;
      padding: 10px;
      padding-left: 20px;
      font-size: 16px;
      width: 300px;
      border: 2px solid black;
      border-radius: 7px;
      box-shadow: 5px 5px 7px black;
      margin-top: 10px;
      margin-left: 180px;
    }
}
  </style>
</head>

<body>
  <div id="form-image" style="background-image: url('images/1.jpg'); height: 605px; background-repeat: no-repeat; background-size: cover; margin: 8px;">
    <!-- <div id="main_btn">
      <div>
        <button type="button" id="btnform"><a href="View_Customer.html">View_Customer</a></button>
        <button type="button" id="btnform"><a href="View_Employee.html">View_Employee</a></button>
        <button class="View_Stock" type="button" id="btnform"><a href="View_Stock.html">View_Stock</a></button>
        <button type="button" id="btnform"><a href="View_Supplier.html">View_Supplier</a></button>
        <button type="button" id="btnform"><a href="View_Purchases.html">View_Purchases</a></button>
        <button type="button" id="btnform"><a href="V_sale.php">View_Sales</a></button>
      </div>
    </div> -->

    
  


    <div id="inputdata">
      <form method="GET" class="row mb-3" id="searchForm">
        <div class="col-md-4">
          <input type="text" name="Product_Name_Male" class="form-control" placeholder="Search by Product Name"
            oninput="fetchStockData()">
        </div>
        <div class="col-md-4">
          <input type="text" name="Retail_Price" class="form-control" placeholder="Search by Retail Price"
            oninput="fetchStockData()">
        </div>
        <div class="col-md-4">
          <input type="text" name="Place" class="form-control" placeholder="Search by Place" oninput="fetchStockData()">
        </div>
      </form>
  </div>


      <!-- <div id="backdiv">
        <button id="back"><a href="admin_dashboard.html">Back</a></button>
      </div> -->

    
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Stock ID</th>
            <th>Product Name</th>
            <th>Box</th>
            <th>Meter</th>
            <th>Retail Price</th>
            <th>Purchase Price</th>
            <th>Quantity</th>
            <th>Gender</th>
            <th>Warehouse ID</th>
            <th>Place</th>
            <th>Season</th>
            <th>Brand</th>
            <th>Out of Stock</th>
            <th>Size</th>
            <th>Category</th>
            <th>Damage Piece</th>
            <th>Description</th>
            <th>Supplier ID</th>
          </tr>
        </thead>
        <tbody id="stockTableBody">
          <!-- Data will be populated by JavaScript -->
        </tbody>
      </table>
    </div>

    
  </div>


    <div id="stockChartContainer">
      <canvas id="stockChart"></canvas>
    </div>



    



    <div class="container mt-3">
      <div class="btn-group" role="group" aria-label="Gender Selection">
        <button type="button" class="btn btn-primary" id="btnMale" onclick="fetchStockData('male')">Male</button>
        <button type="button" class="btn btn-primary" id="btnFemale" onclick="fetchStockData('female')">Female</button>
      </div>
    </div>

    
  <script>
    function fetchStockData(gender) {
  // Form data
  const form = document.getElementById('searchForm');
  const formData = new FormData(form);
  formData.append('Gender', gender); // Add gender to form data

  // Convert form data to query string
  const params = new URLSearchParams(formData).toString();

  // Fetch data based on gender
  fetch('process_view_stock.php?' + params)
    .then(response => response.json())
    .then(data => {
      const tableBody = document.getElementById('stockTableBody');
      tableBody.innerHTML = '';

      if (data.length > 0) {
        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.stock_id}</td>
            <td>${row.Product_Name_Male}</td>
            <td>${row.Box}</td>
            <td>${row.Meter}</td>
            <td>${row.Retail_Price}</td>
            <td>${row.Purchase_Price}</td>
            <td>${row.Quantity}</td>
            <td>${row.Gender}</td>
            <td>${row.Warehouse_ID}</td>
            <td>${row.Place}</td>
            <td>${row.Season}</td>
            <td>${row.Brand}</td>
            <td>${row.Out_of_stock ? 'Yes' : 'No'}</td>
            <td>${row.Size}</td>
            <td>${row.Category}</td>
            <td>${row.Damage_Piece}</td>
            <td>${row.Description}</td>
            <td>${row.supplier_id}</td>
          `;
          tableBody.appendChild(tr);
        });

        updateChart(data);
      } else {
        tableBody.innerHTML = '<tr><td colspan="18">No data found</td></tr>';
        const ctx = document.getElementById('stockChart').getContext('2d');
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      }
    })
    .catch(error => console.error('Error fetching data:', error));
}

function updateChart(data) {
  const productNames = data.map(row => row.Product_Name_Male);
  const quantities = data.map(row => row.Quantity);
  const totalQuantity = quantities.reduce((acc, quantity) => acc + quantity, 0);
  const percentages = quantities.map(quantity => ((quantity / totalQuantity) * 100).toFixed(2));

  const ctx = document.getElementById('stockChart').getContext('2d');

  // Check if stockChart already exists and is an instance of Chart
  if (window.stockChart && window.stockChart instanceof Chart) {
    // Destroy the existing chart
    window.stockChart.destroy();
  }

  // Create new pie chart instance
  window.stockChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: productNames,
      datasets: [{
        label: 'Product Quantity',
        data: quantities,
        backgroundColor: [
          'rgba(255, 99, 132, 0.7)',
          'rgba(54, 162, 235, 0.7)',
          'rgba(255, 206, 86, 0.7)',
          'rgba(75, 192, 192, 0.7)',
          'rgba(153, 102, 255, 0.7)',
          'rgba(255, 159, 64, 0.7)',
          'rgba(255, 99, 132, 0.7)',
          'rgba(54, 162, 235, 0.7)',
          'rgba(255, 206, 86, 0.7)',
          'rgba(75, 192, 192, 0.7)'
          // Add more colors as needed
        ],
        borderColor: [
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(75, 192, 192, 1)',
          'rgba(153, 102, 255, 1)',
          'rgba(255, 159, 64, 1)',
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(75, 192, 192, 1)'
          // Add more colors as needed
        ],
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        tooltip: {
          callbacks: {
            label: function(tooltipItem) {
              const dataset = tooltipItem.chart.data.datasets[tooltipItem.datasetIndex];
              const dataIndex = tooltipItem.dataIndex;
              const value = dataset.data[dataIndex];
              const percentage = ((value / totalQuantity) * 100).toFixed(2);
              return `${productNames[dataIndex]}: ${value} (${percentage}%)`;
            }
          }
        },
        legend: {
          display: true,
          position: 'right',
          labels: {
            padding: 20,
            boxWidth: 20
          }
        },
        outsideLabels: {
          labels: {
            render: 'percentage',
            fontColor: '#000',
            precision: 2
          },
          textMargin: 10
        }
      }
    }
  });
}

// Fetch initial data for 'male' gender
fetchStockData('male');




  
    // Fetch initial data
    // fetchStockData();
  </script>

  
  
</body>

</html>
